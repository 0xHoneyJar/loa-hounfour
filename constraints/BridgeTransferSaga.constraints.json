{
  "$schema": "https://loa-hounfour.dev/schemas/constraint-file.json",
  "schema_id": "BridgeTransferSaga",
  "origin": "genesis",
  "contract_version": "7.0.0",
  "expression_version": "1.0",
  "constraints": [
    {
      "id": "saga-steps-ordered",
      "expression": "steps.every(s => s.step_id != '')",
      "severity": "error",
      "category": "structural",
      "type_signature": {
        "steps": "array"
      },
      "message": "Steps must have non-empty step_ids"
    },
    {
      "id": "saga-amount-conserved",
      "expression": "saga_amount_conserved(saga)",
      "severity": "error",
      "category": "economic",
      "type_signature": {
        "saga": "BridgeTransferSaga"
      },
      "message": "Source debit equals target credit after exchange rate"
    },
    {
      "id": "saga-timeout-positive",
      "expression": "timeout.total_seconds > 0 && timeout.per_step_seconds > 0",
      "severity": "error",
      "category": "structural",
      "type_signature": {
        "timeout": "object"
      },
      "message": "Timeout values must be positive"
    },
    {
      "id": "saga-participants-include-initiator",
      "expression": "participants.length > 0",
      "severity": "error",
      "category": "structural",
      "type_signature": {
        "participants": "array"
      },
      "message": "At least one participant must exist"
    },
    {
      "id": "saga-settled-has-timestamp",
      "expression": "status != 'settled' || settled_at != null",
      "severity": "error",
      "category": "temporal",
      "type_signature": {
        "status": "string",
        "settled_at": "string"
      },
      "message": "Settled sagas must have settled_at timestamp"
    },
    {
      "id": "saga-timeout-valid",
      "expression": "saga_timeout_valid(saga)",
      "severity": "warning",
      "category": "temporal",
      "type_signature": {
        "saga": "BridgeTransferSaga"
      },
      "message": "Completed saga steps must complete within per_step_seconds timeout"
    }
  ]
}
