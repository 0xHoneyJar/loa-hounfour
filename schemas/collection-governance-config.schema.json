{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.0xhoneyjar.com/loa-hounfour/8.2.0/collection-governance-config",
  "additionalProperties": false,
  "description": "Per-collection governance configuration for the Bayesian reputation system.",
  "type": "object",
  "required": [
    "config_id",
    "collection_id",
    "pseudo_count",
    "state_thresholds",
    "decay_policy",
    "updated_at",
    "contract_version"
  ],
  "properties": {
    "config_id": {
      "format": "uuid",
      "type": "string"
    },
    "collection_id": {
      "minLength": 1,
      "description": "The collection this configuration applies to.",
      "type": "string"
    },
    "pseudo_count": {
      "minimum": 1,
      "default": 3,
      "description": "Bayesian conservatism parameter (k). Higher values require more observations before personal score dominates. k=3 (default) requires ~27 observations for authoritative status.",
      "type": "integer"
    },
    "state_thresholds": {
      "additionalProperties": false,
      "description": "Thresholds for reputation state machine transitions.",
      "type": "object",
      "required": [
        "warming_min_events",
        "established_min_samples",
        "authoritative_min_weight"
      ],
      "properties": {
        "warming_min_events": {
          "minimum": 1,
          "default": 1,
          "description": "Minimum quality events to transition cold → warming.",
          "type": "integer"
        },
        "established_min_samples": {
          "minimum": 1,
          "default": 5,
          "description": "Minimum sample count for warming → established.",
          "type": "integer"
        },
        "authoritative_min_weight": {
          "minimum": 0,
          "maximum": 1,
          "default": 0.9,
          "description": "Minimum personal weight for established → authoritative. With k=3, this requires ~27 observations.",
          "type": "number"
        }
      }
    },
    "decay_policy": {
      "$id": "ReputationDecayPolicy",
      "additionalProperties": false,
      "description": "Temporal decay and demotion policy for collection reputation.",
      "type": "object",
      "required": [
        "half_life_days",
        "demotion_rules",
        "enable_auto_demotion"
      ],
      "properties": {
        "half_life_days": {
          "minimum": 1,
          "default": 30,
          "description": "Exponential decay half-life in days. After half_life_days of inactivity, effective sample count is halved.",
          "type": "integer"
        },
        "demotion_rules": {
          "description": "Per-state inactivity demotion rules. Each rule defines when a specific state should be demoted.",
          "type": "array",
          "items": {
            "$id": "DemotionRule",
            "additionalProperties": false,
            "description": "Rule for time-based reputation state demotion due to inactivity.",
            "type": "object",
            "required": [
              "from_state",
              "to_state",
              "inactivity_days"
            ],
            "properties": {
              "from_state": {
                "$id": "ReputationState",
                "anyOf": [
                  {
                    "const": "cold",
                    "type": "string"
                  },
                  {
                    "const": "warming",
                    "type": "string"
                  },
                  {
                    "const": "established",
                    "type": "string"
                  },
                  {
                    "const": "authoritative",
                    "type": "string"
                  }
                ]
              },
              "to_state": {
                "$id": "ReputationState",
                "anyOf": [
                  {
                    "const": "cold",
                    "type": "string"
                  },
                  {
                    "const": "warming",
                    "type": "string"
                  },
                  {
                    "const": "established",
                    "type": "string"
                  },
                  {
                    "const": "authoritative",
                    "type": "string"
                  }
                ]
              },
              "inactivity_days": {
                "minimum": 1,
                "description": "Demote after this many days without quality events.",
                "type": "integer"
              },
              "require_decayed_below": {
                "minimum": 0,
                "maximum": 1,
                "description": "Also require decayed personal weight below this threshold. Prevents demotion of agents whose decayed scores are still strong.",
                "type": "number"
              }
            }
          }
        },
        "enable_auto_demotion": {
          "default": false,
          "description": "Whether demotion rules are automatically enforced. When false, demotion rules are advisory only. When true, requires an event subscription trigger (DR-S1).",
          "type": "boolean"
        }
      }
    },
    "updated_at": {
      "format": "date-time",
      "type": "string"
    },
    "contract_version": {
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Protocol contract version.",
      "type": "string"
    }
  },
  "$comment": "contract_version=8.2.0, min_supported=6.0.0"
}
